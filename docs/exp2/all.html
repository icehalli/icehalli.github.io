<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"> -->
<link href="../styles/site.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link href="../styles/parser.css" rel="stylesheet">
<script src="../scripts/parser.js"></script>
</head>
<body>
    <div id="navTemplate">
        <div id="nav">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                <a class="navbar-brand" href="_json.string.url_">_json.string.home_</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse">
                <ul noid="navlis" class="navbar-nav">
                    <li class="nav-item">
                    <a class="nav-link active" data-url="mbl.is" aria-current="page" href="_json.array.tabs.string.url_">_json.array.tabs.string.label_</a>
                    </li>
                </ul>
                </div>
            </div>
            </nav></div>
        </div>
        <div id="headerTemplate">
            <div id="header"><span>_json.string.data_</span></div>
        </div>
        <div id="contentTemplate">
            <div id="content"><span>_json.string.data_</span></div> 
        </div>
        <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script>    
    
    $(document).ready(function(){
        //ready();
        _Parser.ParseAndRender('body');
        // var layout = $(divToGet);
        // var stuff = layout.html();
        // console.log('html', stuff);
        // $(divToGet).empty();
        // stuff = removeScript(stuff);
        // var p = parseHtml(stuff);
        // renderHtml(p, 0, divToGet);
        //console.log('parseHtml', parseHtml(stuff));
        //AppendPre(removeScript(stuff));
    });
//     function renderHtml(item, indent=0, parent){
//         //debugger
//             var parent = AppendPre(item,indent+4, parent);
//             //debugger
//             if(item.children) {
//                 for(var ch of item.children){
//                     renderHtml(ch, indent + 4, parent);
//                 }
//             }
//             else if(item.rest){
//                 if(parent !== 'body')
//                     AppendPre(item.rest,indent, parent);
//             }
//         // var keys = Object.keys(html);
//         // for(var k of keys){
//         //     var item = html[k];
//         //     console.log(item);
//         //     debugger
//         //     AppendPre(item.el);
//         // }

//     }
//     function parseResultJson(item){
//         //debugger;
//         //for(var i = 0;i<result.length;i++){
//             //var item = result[i];
//             if(item.rest){
//                 var div = $('<div>');
//                 div.html(item.rest);
//                 var children = div.children();
//                 if(children.length > 0){
//                     children.each((i, el) => {
//                         var element = $(el);
//                         console.log(element.html());
//                         //var elChildren = element.children();
//                         var inner = element.html();
//                         element.empty();
//                         var div2 = $('<div>');
//                         div2.html(element);
//                         var t = div2.html();
//                         console.log('t',t);
//                         if(!item.children)
//                             item.children = [];
//                         var parsedEl = parseDomEl(t);
//                         var start = getDomStart(t);
//                         item.children.push({start: start, el: t, parsed: parsedEl, rest: inner});
//                         delete item.rest;
//                         // var id = element.attr('id');            
//                         // ids.push('#'+id);
//                     });
//                 }
//             } 
//             if(item.children){
//                 for(var ch=0;ch<item.children.length;ch++)
//                 {
//                     parseResultJson(item.children[ch]);
//                 }
//             }
//         //}
//         //debugger;
//         //parseResultJson(result);
//     }
//     function getDomStart(t){
//         //debugger
//         return t.split(' ')[0] + '>';
//     }
//     function parseDomEl(el){
//         //debugger
//         var result = {};
//         var $el = $(el);
//         result = getAttributes($(el));
//         return result;
//     };
//     function getAttributes ( $node ) {
//         var attrs = {};
//         $.each( $node[0].attributes, function ( index, attribute ) {
//             attrs[attribute.name] = attribute.value;
//         } );

//         return attrs;
//     }   

//     function parseHtml(text){
//         // var div = $('<div>');
//         // div.html(text);
//         // var children = div.children();
//         var result = [];
//         result.push({el: '<body>', rest:text});
//         parseResultJson(result[0]);
        
//         console.log('result',result);
//         return result[0];
//     }
//     function removeScript(text){
//         var idx = text.split('<script');
//             return idx[0].trim();
//     }
//     function getAllIndexes(arr, val) {
//         var indexes = [], i = -1;
//         while ((i = arr.indexOf(val, i+1)) != -1){
//             indexes.push(i);
//         }
//         return indexes;
//     }
//     function ready(){
//         var layout = $('body');
//         var divs = layout.find("*[id]");
//         divs.each((i, el) => {
//             var element = $(el);
//             var id = element.attr('id');            
//             ids.push('#'+id);
//         });
//         console.log('ids', ids);
//         var result = {};
//         var DomKeys = {};
//         for(var item of ids){
//             var el = $(item);
//             var key = item.replace('#', '');
//             result[key] = {};
//             var text = el.html();
//             console.log('text', text);
//             var res = ext2(text);;
//             result[key] = res.result;
//             DomKeys[key] = res.domString;
//             // var indexes = getAllIndexes(text, '_json.');
//             // console.log('indexes', indexes);
//             // var keys = extractKeys(text, indexes);
//             // result[key] = keys;
//         }
//         console.log('result', result);
//         // showResult(result);
//         // showResult(DomKeys);
//         var idKeys = Object.keys(result);
//         for(var kk of idKeys){
//             var json = result[kk];
//             var doms = DomKeys[kk];
//             var html = $('#' + kk).html();
//             Show(kk, html, json, doms);
//         }
//     }

//     function Show(key, html, json, doms){
//         var h1 = $('<h3>');
//         h1.append(key);
//         $('body').append(h1);
//         AppendPre(html);
//         AppendPre(json);
//         // var htmlpre = $('<pre>');
//         // var encodedStr = encodeHtml(html);
//         // htmlpre.html(encodedStr);
//         // var jsonpre = $('<pre>');
//         // jsonpre.html(JSON.stringify(json, null, 2))

//         // $('body').append(htmlpre);
//         // $('body').append(jsonpre);

//     }

//     function StringIsHtml(str){
//         if(!str){
//             debugger;
//             return str;
//         }
//         return str.trim().indexOf('<') > -1;
//     }
//     function StringIsJson(str){
//         return str.trim().indexOf('{') > -1 || str.trim().indexOf('[]') > -1;
//     }

//     function getRandomInt(min, max) {
//         // Use Math.floor to round down to the nearest whole number
//         // Use Math.random() to generate a random decimal between 0 (inclusive) and 1 (exclusive)
//         // Multiply by the range (max - min + 1) to cover the entire range
//         // Add the minimum value to shift the range to [min, max]
//         return Math.floor(Math.random() * (max - min + 1)) + min;
//     }

//     function AppendPre(object, indent=0, parent){  
//         console.log(object, parent);
//         //debugger;
//         var parentEl = null;
//         var content = object;
//         if(typeof object === 'object')        
//             content = object.el;
//         var pre = $('<div>');
//         var wrapperid = 'wrapper'+getRandomInt(1, 1000);
//         pre.attr('id', wrapperid);
//         pre.addClass('wrapper');
//         if(!parent){
//             //debugger
//             parentEl = $('body');
//         } else {
//             //debugger
//             parentEl =  $(parent);
//             if(parentEl.length === 0){
//                 debugger
//             }

//         }
//         // if(indent > 0) {
//         //     pre.css({marginLeft: indent*10+'px'});
//         // }
// //debugger
// var domDiv = null;
//         if(StringIsHtml(content)){
//             if(content === '<body>')
//                 content = '';
//             domDiv = $('<div>');
//             var domdivId = 'domDiv'+getRandomInt(1, 1000);
//             domDiv.attr('id', domdivId);
//             if(indent > 0) {
//                 domDiv.css({marginLeft: '40px'});
//             }
//             domDiv.addClass('domdiv');
//             //domDiv.css({border: '5px solid green'});
//             if(object.start)
//                 pre.html(encodeHtml(object.start));
//             else
//                 pre.html(encodeHtml(content));
//             if(includeWrapperid)
//                 pre.append(`<span class="sp">(${domdivId})</span>`)
//             domDiv.append(pre);
//             parentEl.append(domDiv);
//             //parentEl.append(`(${domdivId})`)
//             if(object.parsed){
//                 //debugger
//                 var proppre = $('<div>')
//                 var proppreId = 'proppre'+getRandomInt(1, 1000);
//                 proppre.addClass('proppre')
//                 proppre.attr('id', proppreId);
//                 // proppre.css({marginLeft: '40px'});
//                 // proppre.css({border: '1px solid blue'});
//                 // proppre.css({backgroundColor: '#ADD8E6'});
//                 domDiv.append(proppre);
//                 //domDiv.append(`(${proppreId})`)
//                 var parsedKeys = Object.keys(object.parsed);
//                 //debugger
//                 //var 
//                 if(parsedKeys.length > 0){
//                     for(var p of parsedKeys){
//                         var it = object.parsed[p];
//                         var prop = $('<div>');
//                         var propId = 'prop'+getRandomInt(1, 1000);
//                         prop.attr('id', propId);
//                         //prop.css({marginLeft: '-15px'});
//                         var jsonprop = '';
//                         if(it.indexOf('_json.') > -1){
//                             jsonprop = it;
//                             it = '';
//                         }
//                         prop.html(p+"="+it);
//                         if(jsonprop){
//                             var domDivLeaf = $('<span>')
//                             var proppreId = 'proppre'+getRandomInt(1, 1000);
//                             domDivLeaf.attr('id', proppreId);
//                             // domDivLeaf.css({border: '1px solid green'});
//                             // domDivLeaf.css({backgroundColor: '#90EE90'});
//                             domDivLeaf.addClass('jsontext');
//                             domDivLeaf.html(jsonprop);
//                             prop.append(domDivLeaf);
//                         }
//                         if(includeWrapperid)
//                             prop.append(`<span class="sp">(${propId})</span>`)
//                         //debugger
//                         proppre.append(prop);
                        
//                         //AppendPre(p+"="+it, indent + 4, '#' + domDiv.attr('id'));
//                     }
//                 }
//             }

//             // var splittedContent = content.split(' ');
//             // if(splittedContent.length === 1){
//             //     pre.html(encodeHtml(content));
//             // }
//             // else {
//             //     for(var c of splittedContent){
//             //         AppendPre(c, indent);
//             //     }
//             // }
//         }
//         else if(StringIsJson(content)){
//             pre.html(JSON.stringify(content, null, 2));
//             parentEl.append(pre);
//         }
//         else{  
//             //debugger
//             var domDivLeaf = $('<span>')
//             var proppreId = 'proppre'+getRandomInt(1, 1000);
//             domDivLeaf.attr('id', proppreId);
//             domDivLeaf.addClass('jsontext');
//             // domDivLeaf.css({marginLeft: '40px'});
//             // domDivLeaf.css({border: '1px solid green'});
//             // domDivLeaf.css({backgroundColor: '#90EE90'});

//             //pre.html('Text:'+content);
//             domDivLeaf.append(content);
//             parentEl.append(domDivLeaf);
//         }
//         //debugger
//         return domDiv && domDiv.length > 0 ? '#'+ domDiv.attr('id') : '#'+ parentEl.attr('id'); // '#'+ pre.attr('id');
//     }
//     function AppendPreRegular(content){
//         var pre = $('<pre>');

//         if(StringIsHtml(content)){
//             pre.html(encodeHtml(content));
//         }
//         else if(StringIsJson(content)){
//             pre.html(JSON.stringify(content, null, 2));
//         }
//         else{
//             pre.html(content);
//         }
//         $('body').append(pre);
//     }

//     function encodeHtml(html){        
//         var encodedStr = html.replace(/[\u00A0-\u9999<>\&]/g, function(i) {
//             return '&#'+i.charCodeAt(0)+';';
//         });
//         return encodedStr
//     }

//     function showResult(result){
//         var pre = $('<pre>')
//             pre.html(JSON.stringify(result, null, 2));
//             $('body').append(pre);
//     }

//     function ext2(text){
//         var keys = [];
//         var jsonKey = '_json.';
//         var secondKey = '_';
//         while(true) {
//             var index = text.indexOf(jsonKey)
//             text = text.substring(index);
//             text = text.replace(jsonKey, '');
//             var index2 = text.indexOf(secondKey);
//             keys.push(text.substring(0, index2));
//             text = text.substring(index2);
//             if(text.indexOf(jsonKey) < 0)
//                 break;
//         }
//         var result = {};
//         var domString = [];
//        // debugger;
//         for(var key of keys){
//             domString.push(key);
//             var parts = key.split('.');
//             var jsonType = 'key';
//             if(parts[0] === 'array') {
//         //debugger;
//                 jsonType = 'array';
//             }
//             else if(parts[0] === 'object'){
//                 jsonType = 'object';
//             }
//             else{
//                 jsonType = 'key';
//             }
//             var obOrArrName = '';
//             var type = 'string';
//             var name = 'unknown';
//             if(jsonType !== 'key'){
//                 if(jsonType === 'array'){
//                     obOrArrName = parts[1];
//                     type = parts[2];
//                     name = parts[3];
//                     if(!result[obOrArrName])
//                         result[obOrArrName] = [{}];
//                     result[obOrArrName][0][name] = type;
//                     //result[name] = [{}]
//                 }
//                 else if(jsonType === 'object'){
//                     obOrArrName = parts[1];
//                     type = parts[2];
//                     name = parts[3];
//                     if(!result[obOrArrName])
//                         result[obOrArrName] = {};
//                     result[obOrArrName][name] = type;
//                 }
//             }
//             else {
//                 //debugger
//                 type = parts[0];
//                 name = parts[1];
//                     result[name] = type;
//             }
//             console.log('def', name, type, jsonType, obOrArrName);
//         }
//         return {
//             result,
//             domString
//         };
//     }

//     function extractKeys(text, indexes){
//         var res = [];
//         for(var i of indexes) {
//             var k = extractKey(text, i);
//             res.push(k);
//         }
//         console.log('extractedKeys', res);
//         return res;
//     }
    
//     function extractKey(text, index){
//         //debugger
//         var rest = text.substring(index, text.length-index);
//         rest = getPart(rest, '_json.', '_');
//         return rest;
//     }
//     function getPart(str, a, b) {
//         str = str.replace('_json.', '');
//         var _idx = str.indexOf('_');
//         str = str.substring(0, _idx);
//         return str;
//     }
</script>
</body>
</html>
